---
title: 空间映射设计
description: 有效地利用空间映射中 HoloLens 需要仔细考虑许多因素。
author: cre8ivepark
ms.author: dongpark
ms.date: 03/21/2018
ms.topic: article
keywords: Windows Mixed Reality，设计中，空间映射，HoloLens，图面上重新构造、 网格
ms.openlocfilehash: 451213a79e1d482d64725ce750065611830beec3
ms.sourcegitcommit: 17f86fed532d7a4e91bd95baca05930c4a5c68c5
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 06/11/2019
ms.locfileid: "66829962"
---
# <a name="spatial-mapping-design"></a>空间映射设计

有效地利用空间映射中 HoloLens 需要仔细考虑许多因素。

## <a name="device-support"></a>设备支持

<table>
    <colgroup>
    <col width="33%" />
    <col width="33%" />
    <col width="33%" />
    </colgroup>
    <tr>
        <td><strong>功能</strong></td>
        <td><a href="hololens-hardware-details.md"><strong>HoloLens</strong></a></td>
        <td><a href="immersive-headset-hardware-details.md"><strong>沉浸式耳机</strong></a></td>
    </tr>
     <tr>
        <td>空间映射设计</td>
        <td>✔️</td>
        <td>❌</td>
    </tr>
</table>

## <a name="why-is-spatial-mapping-important"></a>空间映射为什么很重要？

空间映射，使可能实际图面上放置对象。 这有助于用户的世界中的定位点对象，并利用的实际深度信息。Occluding 基于其他全息和现实世界对象在全息有助于说服这些全息实际上是其空间中的用户。 在空间中浮动或由用户移动不舒服自在的全息为 real。 如果可能，请舒适的项的位置。

放置或移动的全息 （使用简单的预计的网格） 时，可视化图面。 这将帮助用户知道他们可以最好地放置其全息，并向用户显示是否未尚未映射它们尝试拨全息图的位置。 你可以"广告牌项"朝着用户如果最终在太多角度。

## <a name="what-influences-spatial-mapping-quality"></a>影响空间映射质量？

为了提供最佳用户体验，务必要了解会影响收集的 HoloLens 空间映射数据质量的因素。

空间映射数据中的错误划分为三个类别之一：
* **漏洞**:从空间映射数据缺少实际的图面。
* **Hallucinations**:在现实生活中不存在的空间映射数据中存在图面。
* **偏差**:与现实世界表面，推送或提取不能准确对齐空间映射数据中的图面。

频率和这些错误的严重性，可能会影响几个因素：

* **用户动作**
   * 用户通过其环境的移动确定程度会扫描环境，因此用户可能需要指导，以便实现良好的扫描。
   * 用于扫描使用的照相机提供了 70 度圆锥体，从最小 0.8 米至 3.1 计量距离最多从照相机中的数据。 仅将此字段的视图中扫描实际的图面。 请注意，这些值将在未来版本中进行。
   * 如果用户永远不会获取内 3.1 米的对象然后它将不会扫描。
   * 如果用户仅查看小于 0.8 计量距离之间的对象，则不会扫描 （避免扫描用户的手）。
   * 如果用户永远不会看上去向上 （这是相当普通） 然后上限可能不会扫描。
   * 如果用户永远不会看上去家具或墙后面将不扫描封闭的像素由它们的对象。
   * 表面往往会扫描在较高的质量，而不是在很小的角度进行查看时。
   * 如果头跟踪系统的 HoloLens 暂时失败 （这可能发生由于用户快速动作、 不佳的照明、 featureless 墙或相机变得进行介绍），这可以产生空间映射数据中的错误。 随着时间的推移将更正任何此类错误，随着用户不断四处移动，并扫描其环境。

* **图面上的材料**
   * 在实际的图面上找到的材料大不相同。 这会影响反映数据因为它们会影响如何红外线空间映射的质量。
   * 在来更接近于照相机，因为它们反映较少光之前，可能会不扫描深色图面。
   * 某些图面可能太暗，它们反映了过少光线的扫描从任何距离，因此它们将也引入漏洞错误的位置的图面，并且有时会在后面的图面。
   * 首先，查看时并不从很小的角度查看时，可能仅扫描特别光亮的图面。
   * 镜像，因为他们创建的实际空间和图面，illusory 反射可能会导致漏洞错误和 hallucination 错误。

* **场景运动**
   * 空间映射快速适应变化的环境，如移动用户或打开和关闭的大门。
   * 但是，空间映射可以仅适应区域中的更改时该区域已清楚地显示到用于扫描相机。
   * 因此，很可能这种适应性滞后于实际情况下，这会导致漏洞或 hallucination 错误。
   * 作为示例，用户扫描友元，然后转向，而友元留出空间。 友元 （hallucination 错误） 的 ghost 表示将保留空间映射数据中，直到用户将变回并重新扫描其中友元站着的空间。

* **照明干扰**
   * 环境红外的光线场景中可能会影响扫描，例如强阳光经过一个窗口。
   * 尤其是有光泽的图面可能会影响扫描附近的应用层光反射关闭它们导致的偏差错误。
   * Shiny 应用层协议反射到相机 light 直接与附近的空间，可能会影响导致浮点过程 hallucinations 或延迟适应场景手势等等。
   * 同一房间内有两个 HoloLens 设备不应影响与另一个，但存在五个以上的 HoloLens 设备可能会造成干扰。

它可能是可以避免或纠正这些错误的一些。 但是，应设计应用程序，以便用户能够实现其目标，即使出现空间映射数据中的错误。

## <a name="the-environment-scanning-experience"></a>扫描体验环境

HoloLens 了解在其环境中的图面，因为用户将查看它们。 随着时间推移，HoloLens 构建的环境已观察到的所有部分进行扫描。 为环境中的更改会观察到，它还会更新扫描。 应用启动会自动得到保留此扫描。

使用空间的映射每个应用程序应考虑提供扫描体验;通过该应用程序可引导用户扫描图面，将应用程序才能正常工作所需过程。

![扫描的示例](images/sr-mixedworld-140429-8pm-00068-1000px.png)<br>
*扫描的示例*

此扫描体验性质可能会有所不同，极大地取决于每个应用程序的需求，但是两个主要原则在应指导其设计。

首先，**明确与用户之间的通信是主要考虑因素**。 用户应该始终注意是否满足应用程序的要求。 当它们不满足时，它应立即明确告知用户为什么这是这样，它们应快速导致来采取相应的措施。

其次，**应用程序应尝试的效率和可靠性之间取得平衡**。 它是可以这样做**可靠地**，应用程序应会自动分析空间映射的数据来节省用户时间。 不能可靠地执行此操作，当应用程序应改为使用户能够快速提供具有所需的其他信息的应用程序。

若要帮助设计扫描体验的权限，请考虑以下可能性哪些适用于你的应用程序：

* **无需扫描的经验**
   * 应用程序可能十分正常而无需任何引导式扫描体验;它将学习如何在自然用户移动的过程中观察到的图面。
   * 例如，可让用户使用 holographic spraypaint 图面上绘制的应用程序需要了解仅对用户当前可见的图面。
   * 环境可能会完全扫描已如果它是一个用户已在其中花费了很多时间使用 HoloLens。
   * 请记住但是照相机使用的空间的映射仅可以看到 3.1 m 呈现给用户，因此除非用户已观察到它们从近距离在过去，空间映射将不知道有关任何更远距离的图面。
   * 使用户了解已扫描的图面，该应用程序应提供此效果的可视反馈，例如强制转换到扫描生成的图面上的虚拟阴影可以帮助用户将全息放置这些图面上。
   * 对于这种情况下，空间图面上观察程序的边界卷应为每个帧更新为正文锁定[空间坐标系统](coordinate-systems.md)，以便它们的用户操作。

* **找到合适的位置**
   * 设计应用程序时可能在具有特定要求的位置中使用。
   * 例如，应用程序可能需要用户周围的空白区域，因此它们可以安全地练习 holographic 功夫。
   * 应用程序应通信前期，用户为任何特定要求，并加强其清晰可视反馈。
   * 在此示例中，应用程序应可视化所需的空白区域的范围，并以可视方式突出显示此区域中任何不需要的对象存在。
   * 这种情况下，空间图面上观察程序的边界卷应使用 world 锁定[空间坐标系统](coordinate-systems.md)在所选位置中。

* **查找合适的配置应用层**
   * 应用程序可能需要特定配置的图面，例如两个很大，平面，对立墙，若要创建镜像 holographic hall。
   * 在这种情况下应用程序将需要分析由空间的映射，以检测适合图面，并直接向这些用户提供的图面。
   * 如果应用程序的面分析不是完全可靠，用户应具有一个回退选项。 例如，如果应用程序错误地标识为平面墙上的通道，用户需要更正此错误的简单方法。

* **扫描环境的一部分**
   * 应用程序可能想要仅捕获环境的一部分的用户的指导。
   * 例如，应用程序扫描房间的一部分，因此用户可以发布者想要销售的家具 holographic 分类广告。
   * 在这种情况下，应用程序应捕获性扫描期间观察到用户的区域中的空间映射数据。

* **扫描整个空间**
   * 应用程序可能需要一次扫描的所有当前的空间，包括那些用户隐藏在表面。
   * 例如，一个游戏可能会使用户下的所有方向从接近小 Lilliputians 百号： 围攻 》 的 Gulliver，角色中。
   * 在这种情况下，应用程序将需要确定当前中 surface 所占多少空间已经过扫描，并引导用户的视线移动大量填补了。
   * 此过程的关键提供使的用户尚未扫描的图面的清楚地的可视反馈。 例如可以使用该应用程序[距离基于雾](https://msdn.microsoft.com/library/windows/desktop/bb173401%28v=vs.85%29.aspx)以直观地突出显示的不受空间映射图面区域。

* **拍摄环境的初始快照**
   * 应用程序可能想要使初始 'snapshot' 后忽略在环境中的所有更改。
   * 这可能是适当以避免中断的紧密耦合到环境的初始状态的用户创建的数据。
   * 在这种情况下，应用程序应制作一份空间映射数据在其初始状态后的扫描就完成。
   * 应用程序应继续接收对空间映射数据的更新，如果全息仍正确封闭的环境。
   * 空间映射数据的持续的更新还允许可视化发生，阐明用户环境的以前和现在的状态之间的差异的任何更改。

* **拍摄环境的用户启动的快照**
   * 应用程序可能只想要对环境更改时由用户指示做出响应。
   * 例如，用户可以通过捕获其带来在不同的时候创建多个 3D 状态的一位朋友使用。

* **允许用户更改环境**
   * 应用程序可能会设计中的用户环境中的任何更改实时所做的响应。
   * 例如，绘制窗帘用户可能会触发场景更改 holographic 播放的另一端上发生的。

* **指导用户以避免空间映射数据中的错误**
   * 应用程序可能想要向用户提供指导，尽管它们要扫描其环境。
   * 这可以帮助用户避免某些类型的[空间映射数据中的错误](spatial-mapping-design.md#what-influences-spatial-mapping-quality)，例如通过保持 sunlit windows 或镜像服务器以外的地方。

一个额外的详细信息，需要注意的是，空间映射数据的范围不是不受限制。 同时空间映射 does 构建大型空间的永久数据库，它仅将这些数据可应用程序中气泡围绕用户的有限大小。 因此如果长走廊和足够的距离开始，遍历的开头开始，则返回在开始处的空间表面最终将会消失。 当然，可以缓解此问题通过后它们已消失的可用空间的映射数据缓存在应用程序中的这些图面。

## <a name="mesh-processing"></a>网格处理

它可能有助于检测图面中的常见错误的类型和筛选、 删除或修改相应的空间映射数据。

请记住该空间映射的数据用于尽可能为忠实于实际的图面，这样任何处理则你将应用转移最荒谬不过了曲面的风险。

下面是不同类型的网格处理，您可能会找到有用的一些示例：

* **孔填充**
   * 如果无法扫描的深色材料进行一个小的对象，将保留一个三角形孔周围的图面中。
   * 漏洞影响封闭： 全息可以看到通过据推测不透明的实际的图面中一个孔。
   * 漏洞影响 raycasts： 如果使用 raycasts 来帮助用户与图面进行交互，则可能是不可取的这些大气通过漏洞。 一种解决方法是使用多个 raycasts 覆盖相应大小的区域的捆绑包。 这样，您可以筛选离群值的结果，以便即使一个 raycast 通过一个小口，聚合结果仍将有效。 但是，请注意，这种方法需要付出一定代价计算。
   * 漏洞影响物理冲突： 由物理模拟控制的对象可能会通过一个孔 floor 删除并成为丢失。
   * 它是可以从算法上填充此类漏洞的表面网格中。 但是，你将需要优化您的算法，以便实际洞 windows 和走廊等执行不会填充它。 它可能很难可靠地区分实际洞从虚部洞，因此将需要尝试使用不同的试探法，例如大小和边界形状。

* **Hallucination 删除**
   * 反射、 亮灯和移动对象会使小型延迟 hallucinations 过程中的浮点。
   * Hallucinations 影响封闭： hallucinations 可能会变得可见为深色形状前面的移动和 occluding 其他全息。
   * Hallucinations 影响 raycasts： 如果使用 raycasts 来帮助用户与图面进行交互，这些大气会遇到 hallucination 而不是其背后的图面。 与漏洞，一种解决方法是使用许多 raycasts 而不是单个 raycast，但再次这会在计算成本。
   * Hallucinations 影响物理冲突： 由物理模拟控制的对象可能会停滞在针对 hallucination 且无法进行的空间表面上清除区域中移动。
   * 就可以筛选此类 hallucinations 从表面网格。 但是，与漏洞，您需要优化您的算法，以便实际小对象，例如 lamp 代表和不需要删除门句柄。

* **平滑处理**
   * 空间映射可能会返回似乎是粗略或噪音对应的实际相比的图面。
   * 流畅程度影响物理冲突： 如果粗略基底，以物理方式模拟的高尔夫球可能不回滚顺利地跨它在一条直线。
   * 流畅程度会影响呈现： 粗略的表面法线如果直接可视化图面，可影响其外观并中断干净的外观。 很可能为了缓解此问题在着色器，用于呈现图面中使用相应的照明和纹理。
   * 就可以消除粗糙度图面上的网格中。 但是，此操作可能会将推送面进一步远离相应实际的图面。 维护关闭对应关系是以生成准确全息图的阻挡物，以及使用户能够实现与全息图面之间的精确且可预测的交互很重要。
   * 如果只需要修饰性的更改，则它可能足以而无需更改顶点位置的平滑顶点的法向。

* **平面查找**
   * 有许多形式的应用程序可能想要提供的空间映射图面上执行的分析。
   * 一个简单的例子是平面查找;标识应用层协议的界定，主要是平面区域。
   * 平面数据区域可以用作 holographic 工作台面，holographic 内容可以自动放置的位置由应用程序的区域。
   * 平面数据区域可以限制用户界面，以指导用户与在最适合其需求的图面进行交互。
   * 平面数据区域可用于如下所示现实生活中，对功能的对象，如 LCD 屏幕、 表或白板 holographic 对应项。
   * 平面数据区域可以定义 play 区域，从而形成视频游戏设备级别的基础。
   * 平面数据区域可帮助导航现实生活中，通过标识的真实的人有可能在引导 floor 区域的虚拟代理。

## <a name="prototyping-and-debugging"></a>原型制作和调试

### <a name="useful-tools"></a>有用的工具
* [HoloLens 模拟器](using-the-hololens-emulator.md)可用于使用空间的映射，而无需访问物理 HoloLens 开发应用程序。 它使您可以模拟在真实环境中 HoloLens 上的实时会话，所有数据的应用程序通常占用，包括 HoloLens 运动、 空间坐标系和坐标空间映射网格。 这可以用于提供可靠、 可重复输入，也可用于调试的问题和评估更改代码。
* 若要重现方案，通过网络从实时 HoloLens，捕获空间映射的数据，然后将其保存到磁盘，然后在后续调试会话中重复使用它。
* [Windows 设备门户 3D 视图](using-the-windows-device-portal.md#3d-view)提供方法以查看所有空间映射系统可以通过当前可用空间表面。 这为应用程序; 中的空间图面提供了比较基础例如，可以轻松地了解任何空间表面是否缺失或显示在错误的位置。

### <a name="general-prototyping-guidance"></a>常规原型设计指南
* 因为[错误](spatial-mapping-design.md#what-influences-spatial-mapping-quality)空间映射中的数据强可能会影响你的用户体验，我们建议你在各种环境中测试应用程序。
* 不习惯于在相同的位置，例如在办公桌旁始终测试获取捕获。 请确保在不同的位置、 形状、 大小和材料的各个图面上进行测试。
* 同样，虽然综合或记录的数据可用于调试，不会变得太依赖相同的几个测试用例。 这可能会延迟查找更多不同的测试将先前捕获的重要问题。
* 它是执行测试与实部 （和理想情况下取消警告） 的用户，一个好办法，因为它们不得 HoloLens 或你的应用程序以使用完全相同的方式执行的操作。 事实上，它会让您大吃一惊如何同名的不同人的行为，可以是知识和假设 ！

## <a name="see-also"></a>请参阅
* [房间扫描可视化](room-scan-visualization.md)
* [空间音效设计](spatial-sound-design.md)
* [Unity 中的持久性](persistence-in-unity.md)
