---
title: 全息影像稳定性
description: HoloLens 自动稳定了全息影像, 但开发人员可以进一步提高全息影像稳定性。
author: thetuvix
ms.author: alexturn
ms.date: 03/21/2018
ms.topic: article
keywords: 全息影像, 稳定性, hololens
ms.openlocfilehash: b35b904e3c662c5ebd0670a98044706fe208e348
ms.sourcegitcommit: c20563b8195c0c374a927b96708d958b127ffc8f
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 05/21/2019
ms.locfileid: "65974940"
---
# <a name="hologram-stability"></a>全息影像稳定性

为实现稳定的全息影像, HoloLens 提供内置的图像稳定性管道。 稳定管道在后台自动运行, 因此不需要执行额外的步骤来启用它。 但是, 开发人员应运用改善全息影像稳定性的技术, 避免降低稳定性的方案。

## <a name="hologram-quality-terminology"></a>全息影像质量术语

全息影像的质量是良好的环境和良好的应用程序开发。 在 HoloLens 可以跟踪周围的环境中, 每秒遇到常量60帧的应用将确保全息影像和匹配坐标系处于同步。从用户的角度来看, 要保持静止的全息影像不会相对于环境移动。

出现环境问题、不一致或较低的呈现速率或其他应用程序问题时, 以下术语对于识别问题很有帮助。
* **准确性.** 一旦将全息图全局锁定并放置在现实世界中, 就应将它放置在相对于周围环境的位置, 与用户运动或小型和稀疏环境更改无关。 如果在意外的位置出现全息图, 则这是一个*准确性*问题。 如果两个不同的房间看起来相同, 则可能会发生这种情况。
* **抖动.** 用户将其视为全息影像的高频握手。 跟踪环境时可能会发生这种情况。 对于用户, 解决方案正在运行[传感器调整](sensor-tuning.md)。
* **Judder.** 低渲染频率会导致动画的不均匀运动和双图像。 这在动态影像中尤其明显。 开发人员需要维护[常量 60 FPS](hologram-stability.md#frame-rate)。
* **光标.** 用户将其视为全息图, 以使其远离其最初放置位置。 如果在离[空间锚](spatial-anchors.md), 而不是完全映射的环境部分中放置全息影像, 则会发生这种情况。 创建与空间锚接近的全息影像会降低偏移的可能性。
* **Jumpiness.** 当全息影像 "弹" 或 "跳转" 偶尔远离其位置时。 这种情况可能会发生, 因为跟踪会调整全息影像, 以匹配更新的环境。
* **泳道.** 当 sway 与用户的头运动相对应时, 会出现一个全息图。 如果全息影像不在[稳定平面](hologram-stability.md#stabilization-plane)上, 并且没有为当前用户[校准](calibration.md)HoloLens, 则会发生这种情况。 用户可以重新运行[校准](calibration.md)应用程序以解决此问题。 开发人员可以更新稳定平面, 以进一步增强稳定性。
* **颜色分离。** HoloLens 中的显示是一种颜色顺序显示, 它以60Hz 为绿色的红绿蓝绿色的颜色通道 (在240Hz 上显示单个颜色字段)。 无论用户何时使用其眼睛跟踪搬迁全息图, 都将在其构成颜色中分离出全息图的前导和尾随边缘, 从而产生彩虹效果。 分离程度取决于全息图的速度。 在某些罕见情况下, 在查看固定全息图的同时迅速移动打印头也会导致彩虹效果。 这称为 *[颜色分离](hologram-stability.md#color-separation)* 。

## <a name="frame-rate"></a>帧速率

帧速率是全息图稳定性的第一个支柱。 要使全息影像在世界中显得稳定, 提供给用户的每个图像都必须在正确的位置中绘制出全息影像。 每秒显示一次 HoloLens 刷新 240, 为每个新呈现的图像显示四个单独的颜色字段, 导致用户体验 60 FPS (每秒帧数)。 若要提供最佳体验, 应用程序开发人员必须维护 60 FPS, 这将转换为每16毫秒向操作系统持续提供一次新映像。

**60 FPS**为了绘出全息影像, 使其看起来像是真实世界, 需要从用户的位置呈现图像。 由于图像渲染需要时间, 因此在显示器中显示图像时, HoloLens 会预测用户的头。 此预测算法是近似值。 HoloLens 有一些硬件, 可调整呈现的图像, 以考虑预测的头位置与实际头位置之间的差异。 这会使用户看到的图像看起来就像是从正确位置呈现的一样, 而全息影像却是稳定的。 映像更新最适合进行少量更改, 它无法完全修复呈现的图像 (如视差) 中的某些项。

通过在 60 FPS 的情况下呈现, 你可以执行三项操作来帮助实现稳定的全息影像:
1. 最大程度地降低渲染图像和用户查看图像之间的总体延迟。 在具有游戏线程的引擎和在一脉相承中运行的渲染线程中, 在30FPS 上运行会添加 33.3 ms 的额外延迟。 通过减少延迟, 这会减少预测误差, 并增加全息影像的稳定性。
2. 这样, 每个图像都能达到用户的眼睛, 并具有一致的延迟时间。 如果在30fps 上呈现, 则显示的图像仍以 60 FPS 显示。 这意味着同一映像将在一行中显示两次。 第二个帧比第一帧具有 16.6 ms 的延迟时间, 并将不得不更正更明显的错误量。 这种错误的不一致会导致不需要的 judder。
3. 减少 judder 的外观, 其特征是不均匀的运动和双图像。 更快的全息图运动和更小的呈现速率与更明显的 judder 相关联。 因此, 在任何时候都努力维持 60 FPS, 将有助于避免给定移动全息图的 judder。

**帧速率一致性**帧速率一致性与高帧/秒一样重要。 对于任何内容丰富的应用程序, 偶尔丢弃的帧都是不可避免的, 而且 HoloLens 实现了一些复杂的算法来从偶然的故障中恢复。 但是, 对于用户而言, 持续波动的帧比以较低的帧速率持续运行要多得多。 例如, 对于5帧 (在这5帧的持续时间内为 60 FPS) 呈现的应用程序, 然后每隔一帧删除下10帧 (30 FPS, 持续时间为30帧)以 30 FPS 的速度呈现。

在相关说明中, 当[混合现实捕获](mixed-reality-capture.md)正在运行时, 操作系统会将应用程序限制为 30 FPS。

**性能分析**可以使用多种工具来基准应用程序帧速率, 如:
* GPUView
* Visual Studio 图形调试器
* 内置于三维引擎 (如 Unity) 的探查器

## <a name="hologram-render-distances"></a>全息图呈现距离

>[!VIDEO https://www.youtube.com/embed/-606oZKLa_s]

当 fixates 和专注于某个对象时, 该视觉对象系统会集成多个距离相关的信号。
* [便利设施](https://en.wikipedia.org/wiki/Accommodation_%28eye%29)-单个眼睛的重点。
* [收敛](https://en.wikipedia.org/wiki/Convergence_(eye))-两个眼睛向内或向外移动到对象的中心。
* [望远镜视觉](https://en.wikipedia.org/wiki/Stereopsis)对象-在与固定点远离某个对象距离的左侧和右侧图像之间发达国家。
* 底纹、相对角度大小和其他 monocular (单一眼睛) 提示。

收敛和便利设施是唯一的, 因为它们是视网膜的提示, 与眼睛在不同距离上感知对象的方式相关。 在自然查看中, 聚合和便利设施均已链接。 当眼睛接近时 (例如, 鼻子), 眼睛交叉并适应近点。 当眼睛查看无限大时, 眼睛会并行出现, 并且眼睛可容纳无限大。 戴 HoloLens 的用户将始终适应 2.0 m 以维护一个清晰的图像, 因为 HoloLens 显示固定在远离用户的光纤上。 应用开发人员通过在不同的深度放置内容和全息影像来控制用户的眼睛汇聚。 当用户容纳并聚合到不同的距离时, 两个提示之间的自然链接会断开, 这可能会导致 visual discomfort 或疲劳, 特别是当冲突的量大时。 可以通过保留用户最接近 2.0 m 的内容来避免或最大限度地减少 vergence 的 Discomfort, 例如, 在具有很多深度的场景中, 可能会有很多相关区域。 当用户在不同距离之间来回注视时, 当内容不能放在 vergence-accomodation 冲突中时, 不能放置在 2.0 m discomfort 附近。 换而言之, 看看50cm 的静止全息图比查看一段时间内远离你的全息图50cm 更容易。

将内容置于 2.0 m 也是有好处的, 因为这两个显示器被设计为完全重叠。 对于放置在此平面之外的图像, 当它们移出全息帧的一侧时, 它们会从一次显示中消失, 同时仍然可见。 此望远镜 rivalry 可能会对全息图的深度认知造成中断。

**从用户处放置全息影像的最佳距离**

![从用户处放置全息影像的最佳距离](images/distanceguiderendering-750px.png)

**剪辑平面**为了最大限度地放心, 我们建议在85cm 上剪辑渲染距离, fadeout 的内容从1m 开始。 在影像和用户均为静止全息影像的应用程序中, 可以轻松地查看50cm 等。 在这种情况下, 应用程序应放置一个离30cm 更近的剪辑平面, 并从剪切面至少开始10cm。 只要内容比85cm 更近, 就必须确保用户不会频繁地从全息影像移近或远离用户, 否则, 在这些情况下, 这种情况很可能导致 discomfortvergence-住宿冲突。 内容应设计为最大程度地减少对用户交互的需要, 但当内容必须比85cm 更接近时, 开发人员的经验法则就是设计这样的方案: 用户和/或全息影像不会深入超过 25% 的 t 85cm他的时间。

**最佳做法**如果无法在2m 中放置全息影像并且无法避免聚合和便利设施之间发生冲突, 则全息图位置的最佳区域介于 1.25 m 和5分钟之间。 在每种情况下, 设计器都应该构建内容来鼓励用户与 1 + m 交互 (例如, 调整内容大小和默认位置参数)。

## <a name="stabilization-plane"></a>稳定平面
> [!NOTE]
> 对于桌面沉浸式耳机, 设置稳定面通常会提高效率, 因为它提供的视觉质量不如向系统提供应用的深度缓冲区来启用基于深度的 reprojection。 除非在 HoloLens 上运行, 否则通常应避免设置稳定平面。

HoloLens 执行复杂的硬件辅助全息稳定技术。 这在很大程度上是自动进行的, 并且必须在场景动画处理并且用户移动其标题时, 对视图 (CameraPose) 的动作和变化进行处理。 将选择一个称为 "稳定" 平面的平面来最大程度地提高此稳定性。 尽管场景中的所有全息影像都接收到一些稳定性, 但稳定面中的全息影像会接收到最大的硬件稳定。

![三维对象的稳定平面](images/stab-plane-500px.jpg)

设备将自动尝试选择此平面, 但应用程序可以通过选择场景中的焦点来帮助完成此过程。 在 HoloLens 上运行的 Unity 应用应根据场景选择最佳关注点, 并将其传递到[SetFocusPoint ()](focus-point-in-unity.md)。 默认的旋转多维数据集模板中包含了在 DirectX 中设置焦点的示例。

请注意, 当 Unity 应用在连接到台式计算机的沉浸式耳机上运行时, Unity 将向 Windows 提交深度缓冲区以启用每像素 reprojection, 这通常会提供更好的图像质量, 无需应用显式工作。 如果你提供了焦点, 则将重写每像素 reprojection, 因此, 仅当你的应用程序在 HoloLens 上运行时, 才应这样做。




```cs
// SetFocusPoint informs the system about a specific point in your scene to
// prioritize for image stabilization. The focus point is set independently
// for each holographic camera.
// You should set the focus point near the content that the user is looking at.
// In this example, we put the focus point at the center of the sample hologram,
// since that is the only hologram available for the user to focus on.
// You can also set the relative velocity and facing of that content; the sample
// hologram is at a fixed point so we only need to indicate its position.
renderingParameters.SetFocusPoint(
    currentCoordinateSystem,
    spinningCubeRenderer.Position
    );
```

焦点的位置很大程度上取决于全息图的外观。 应用具有用于引用的 "注视" 向量, 应用设计器知道他们希望用户看到哪些内容。

开发人员可对稳定全息影像执行的最重要的一项操作是以 60 FPS 的帧呈现。 如果低于 60 FPS, 将大大减少全息图稳定性, 而不考虑稳定性平面优化。

**最佳做法**没有通用的方法来设置稳定面, 它是特定于应用的, 因此, 主要建议是试验并了解最适合你的方案的情况。 但是, 请尽量将稳定平面与尽可能多的内容对齐, 因为此平面上的所有内容都是完美稳定的。

例如：
* 如果只有平面内容 (读取应用程序、视频播放应用程序), 请将 "稳定" 平面与包含内容的平面对齐。
* 如果有3个小球体处于世界锁定状态, 请将 "稳定" 平面视为当前位于用户视图中的所有球的中心。
* 如果场景的内容在深度上非常不同, 则更倾向于获取更多对象。
* 确保调整每个帧的稳定点, 使其与用户正在查看的全息图一致

**要避免的问题**稳定面是实现稳定的全息影像的极佳工具, 但如果误用它, 可能会导致严重的映像不稳定。
* 不要 "火灾", 因为最终会出现用户之后的稳定平面, 或连接到不再位于用户视图中的对象。 确保稳定平面正常设置为相对相机前进 (例如, 照相机)
* 不要在两个极端之间来回更改稳定平面
* 不要将稳定平面设置为固定距离/方向
* 不要让稳定面贯穿用户
* 在台式计算机上运行时, 请勿设置焦点, 而不是使用基于像素的深度 reprojection。

## <a name="color-separation"></a>颜色分离 

由于 HoloLens 显示的性质, 有时会出现名为 "颜色分离" 的项目。 它将以图像形式表现为单独的基本颜色 (红色、绿色和蓝色)。 当显示白色对象时, 项目尤其可见, 因为它们有大量的红色、绿色和蓝色。 当用户以快速方式跟踪在全息帧上移动的全息影像时, 最有可能的。 项目的另一种方式是对象的扭曲/变形。 如果对象具有高对比度和/或纯颜色 (红色、绿色、蓝色), 则颜色分隔会被视为对象的不同部分的弯曲。

**打印头锁定空心轮光标的颜色分离的示例可能类似于用户将其头旋转到侧面:**

![打印头锁定空心轮光标的颜色分离的示例可能类似于用户将其头旋转到一边。](images/colorseparationofroundwhitecursor-300px.png)

尽管很难完全避免颜色分离, 但有几种方法可用于缓解这种情况。

**可以在以下项上查看颜色分隔:**
* 正在快速移动的对象, 包括 head 锁定对象, 如[光标](cursors.md)。
* 远离[稳定平面](hologram-stability.md#stabilization-plane)的对象。

**衰减颜色分离的效果:**
* 使对象滞后用户。 它应显示为具有某种惯性, 并附加到注视 "on 弹簧"。 这会减慢游标的速度 (减少分离距离), 并将其放在用户可能的注视点之后。 只要用户停止移动其看起来就会很自然。
* 如果你确实想要移动一张全息图, 如果预计用户会将其带到其眼睛下, 请尽量使其移动速度低于5度/秒。
* 使用*光*而不是*几何图形*作为光标。 附加到注视的虚拟照明源将被视为交互式指针, 但不会导致颜色分离。
* 调整 "稳定" 平面, 使其与用户正在 gazing 的全息影像匹配。
* 使对象变为红色、绿色或蓝色。
* 切换到内容的模糊版本。 例如, 在运动方向上, 圆形白色光标可能会更改为稍微模糊的线条。

与之前一样, 在 60 FPS 和设置 "稳定" 平面的情况下, 最重要的技术是全息图稳定性。 如果有明显的颜色分离, 请首先确保帧速率符合预期。

## <a name="see-also"></a>请参阅
* [了解混合现实的性能](understanding-performance-for-mixed-reality.md)
* [颜色、光线和材料](color,-light-and-materials.md)
* [本能交互](interaction-fundamentals.md)